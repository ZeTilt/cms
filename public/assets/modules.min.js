window.moduleManagerLoaded?console.log("Module manager already loaded, skipping..."):(window.moduleManagerLoaded=!0,document.addEventListener("DOMContentLoaded",function(){console.log("Module management JS loaded (new version)"),console.log("Current URL:",window.location.href);const e=document.querySelectorAll('button[onclick*="toggleModule"]'),t=document.querySelectorAll("button[data-module]");function o(e,t){document.querySelectorAll(".notification").forEach(e=>e.remove());const o=document.createElement("div");o.className="notification fixed top-4 right-4 p-4 rounded-md shadow-lg z-50 transition-all duration-300 "+("success"===t?"bg-green-500 text-white":"bg-red-500 text-white"),o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.style.opacity="0",setTimeout(()=>o.remove(),300)},3e3)}function n(e,t){console.log("toggleModule called with:",e,t);const n=t?"activate":"deactivate";if(!confirm(`Are you sure you want to ${n} the ${e} module?`))return void console.log("User cancelled action");console.log(`Proceeding with ${e} ${n}`);const a=document.querySelectorAll('button[onclick*="toggleModule"]');a.forEach(e=>{e.disabled=!0,e.classList.add("opacity-50")});const l=new FormData;l.append("action",n),fetch(`/admin/modules/${e}/toggle`,{method:"POST",body:l,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}).then(e=>{if(console.log("Response status:",e.status),!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()}).then(e=>{console.log("Response data:",e),e.success?(o(e.message,"success"),setTimeout(()=>{window.location.reload()},1500)):(o(e.message||"An error occurred","error"),a.forEach(e=>{e.disabled=!1,e.classList.remove("opacity-50")}))}).catch(e=>{console.error("Fetch error:",e),o("Network error: "+e.message,"error"),a.forEach(e=>{e.disabled=!1,e.classList.remove("opacity-50")})})}console.log("Available onclick buttons:",e.length),console.log("Available data buttons:",t.length),window.toggleModule=n;const a=document.querySelectorAll("button[data-module]");a.forEach(e=>{console.log("Setting up button:",e.dataset.module,e.dataset.action),e.hasAttribute("onclick")&&(console.log("Removing onclick from",e.dataset.module),e.removeAttribute("onclick")),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("Button clicked via addEventListener:",this.dataset.module,this.dataset.action);n(this.dataset.module,"activate"===this.dataset.action)}),e.onclick=function(e){e.preventDefault(),e.stopPropagation(),console.log("Button clicked via onclick:",this.dataset.module,this.dataset.action);return n(this.dataset.module,"activate"===this.dataset.action),!1}}),setTimeout(()=>{console.log("Testing button clickability..."),a.forEach(e=>{const t=e.getBoundingClientRect(),o=t.width>0&&t.height>0,n=!e.disabled;console.log(`Button ${e.dataset.module}: visible=${o}, enabled=${n}, disabled=${e.disabled}`)})},1e3)}));