class PhotoGallery{constructor(){this.lightbox=null,this.currentIndex=0,this.images=[],this.init()}init(){this.createLightbox(),this.bindEvents()}createLightbox(){document.body.insertAdjacentHTML("beforeend",'\n            <div class="lightbox" id="lightbox">\n                <div class="lightbox-content">\n                    <button class="lightbox-close" id="lightbox-close">\n                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <line x1="18" y1="6" x2="6" y2="18"></line>\n                            <line x1="6" y1="6" x2="18" y2="18"></line>\n                        </svg>\n                    </button>\n                    <button class="lightbox-nav lightbox-prev" id="lightbox-prev">\n                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <polyline points="15,18 9,12 15,6"></polyline>\n                        </svg>\n                    </button>\n                    <button class="lightbox-nav lightbox-next" id="lightbox-next">\n                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                            <polyline points="9,18 15,12 9,6"></polyline>\n                        </svg>\n                    </button>\n                    <img id="lightbox-image" src="" alt="">\n                    <div class="lightbox-info" id="lightbox-info">\n                        <h3 id="lightbox-title"></h3>\n                        <p id="lightbox-description"></p>\n                    </div>\n                    <div class="lightbox-counter" id="lightbox-counter"></div>\n                </div>\n            </div>\n        '),this.lightbox=document.getElementById("lightbox")}bindEvents(){document.addEventListener("click",t=>{const e=t.target.closest(".gallery-item");e&&(t.preventDefault(),this.openLightbox(e))}),document.getElementById("lightbox-close").addEventListener("click",()=>this.closeLightbox()),document.getElementById("lightbox-prev").addEventListener("click",()=>this.previousImage()),document.getElementById("lightbox-next").addEventListener("click",()=>this.nextImage()),document.addEventListener("keydown",t=>{if(this.lightbox.classList.contains("active"))switch(t.key){case"Escape":this.closeLightbox();break;case"ArrowLeft":this.previousImage();break;case"ArrowRight":this.nextImage()}}),this.lightbox.addEventListener("click",t=>{t.target===this.lightbox&&this.closeLightbox()})}openLightbox(t){const e=t.closest(".photo-gallery");this.images=Array.from(e.querySelectorAll(".gallery-item")).map(t=>({src:t.querySelector("img").src,title:t.dataset.title||t.querySelector("img").alt,description:t.dataset.description||""})),this.currentIndex=Array.from(e.querySelectorAll(".gallery-item")).indexOf(t),this.showImage(),this.lightbox.classList.add("active"),document.body.style.overflow="hidden"}closeLightbox(){this.lightbox.classList.remove("active"),document.body.style.overflow=""}previousImage(){this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.images.length-1,this.showImage()}nextImage(){this.currentIndex=this.currentIndex<this.images.length-1?this.currentIndex+1:0,this.showImage()}showImage(){const t=this.images[this.currentIndex];document.getElementById("lightbox-image").src=t.src,document.getElementById("lightbox-title").textContent=t.title,document.getElementById("lightbox-description").textContent=t.description,document.getElementById("lightbox-counter").textContent=`${this.currentIndex+1} / ${this.images.length}`;const e=document.getElementById("lightbox-prev"),i=document.getElementById("lightbox-next");this.images.length<=1?(e.style.display="none",i.style.display="none"):(e.style.display="flex",i.style.display="flex")}}function createGallery(t,e,i={}){const n=document.getElementById(t);if(!n)return;const{size:o="medium",showOverlay:l=!0,columns:s=null}=i;let r="photo-gallery";"small"===o&&(r+=" small"),"large"===o&&(r+=" large");const d=`\n        <div class="${r}" ${s?`style="grid-template-columns: repeat(${s}, 1fr)"`:""}>\n            ${e.map(t=>`\n                <div class="gallery-item" data-title="${t.title||""}" data-description="${t.description||""}">\n                    <img src="${t.src}" alt="${t.alt||t.title||"Image"}">\n                    ${l&&(t.title||t.description)?`\n                        <div class="overlay">\n                            ${t.title?`<h4>${t.title}</h4>`:""}\n                            ${t.description?`<p>${t.description}</p>`:""}\n                        </div>\n                    `:""}\n                </div>\n            `).join("")}\n        </div>\n    `;n.innerHTML=d}document.addEventListener("DOMContentLoaded",()=>{new PhotoGallery});class ArticleCarousel{constructor(){this.carousels=[],this.init()}init(){this.processCarouselShortcodes(),this.initializeCarousels()}processCarouselShortcodes(){const e=document.querySelector(".article-content, .prose");if(!e)return;const t=/\[carousel\](.*?)\[\/carousel\]/g;let s,l=e.innerHTML,n=0;for(;null!==(s=t.exec(l));){const e=s[1].split(",").map(e=>e.trim()).filter(e=>e);if(e.length>0){const t=this.generateCarouselHtml(e,n);l=l.replace(s[0],t),n++}}e.innerHTML=l}generateCarouselHtml(e,t){const s=e.map((e,t)=>`\n            <div class="carousel-slide ${0===t?"active":""}" data-slide="${t}">\n                <img src="${e}" alt="Image ${t+1}" class="w-full h-64 md:h-80 object-cover rounded-lg">\n            </div>\n        `).join(""),l=e.map((e,t)=>`\n            <button class="carousel-dot ${0===t?"active":""}" data-slide="${t}"></button>\n        `).join("");return`\n            <div class="article-carousel my-8" data-carousel-id="${t}">\n                <div class="relative overflow-hidden rounded-lg bg-gray-100">\n                    <div class="carousel-container relative">\n                        ${s}\n                    </div>\n                    \n                    ${e.length>1?`\n                        \x3c!-- Navigation arrows --\x3e\n                        <button class="carousel-prev absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200">\n                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>\n                            </svg>\n                        </button>\n                        <button class="carousel-next absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-70 text-white p-2 rounded-full transition-all duration-200">\n                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>\n                            </svg>\n                        </button>\n                        \n                        \x3c!-- Indicators --\x3e\n                        <div class="carousel-indicators absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">\n                            ${l}\n                        </div>\n                    `:""}\n                </div>\n            </div>\n        `}initializeCarousels(){document.querySelectorAll(".article-carousel").forEach(e=>{this.setupCarousel(e)})}setupCarousel(e){const t=e.querySelectorAll(".carousel-slide"),s=e.querySelectorAll(".carousel-dot"),l=e.querySelector(".carousel-prev"),n=e.querySelector(".carousel-next");let r=0;const o=e=>{t.forEach(e=>e.classList.remove("active")),s.forEach(e=>e.classList.remove("active")),t[e].classList.add("active"),s[e]&&s[e].classList.add("active"),r=e},a=()=>{const e=(r+1)%t.length;o(e)},i=()=>{const e=(r-1+t.length)%t.length;o(e)};l&&l.addEventListener("click",i),n&&n.addEventListener("click",a),s.forEach((e,t)=>{e.addEventListener("click",()=>o(t))});let c=setInterval(a,5e3);e.addEventListener("mouseenter",()=>clearInterval(c)),e.addEventListener("mouseleave",()=>{c=setInterval(a,5e3)}),this.carousels.push({element:e,currentSlide:r,totalSlides:t.length,showSlide:o,nextSlide:a,prevSlide:i})}}document.addEventListener("DOMContentLoaded",()=>{new ArticleCarousel}),window.initializeCarousels=()=>{new ArticleCarousel};function handleYouTubeThumbnailError(t){const e=JSON.parse(t.getAttribute("data-fallback-urls"));let n=parseInt(t.getAttribute("data-current-index"));n++,n<e.length?(t.setAttribute("data-current-index",n),t.src=e[n]):showYouTubePlaceholder(t)}async function validateYouTubeThumbnail(t){if(t.hasAttribute("data-validated"))return!0;if(t.setAttribute("data-validated","true"),t.naturalWidth&&t.naturalWidth<=120)return console.log(`YouTube thumbnail too small (${t.naturalWidth}x${t.naturalHeight}), trying fallback`),handleYouTubeThumbnailError(t),!1;try{await fetch(t.src,{method:"HEAD",mode:"no-cors"});return t.naturalWidth<=120||t.naturalHeight<=90?(console.log("YouTube thumbnail dimensions too small, trying fallback"),handleYouTubeThumbnailError(t),!1):(console.log(`YouTube thumbnail appears valid (${t.naturalWidth}x${t.naturalHeight})`),!0)}catch(e){return console.log("Could not fetch thumbnail, checking dimensions instead"),!(t.naturalWidth<=120||t.naturalHeight<=90)||(console.log("YouTube thumbnail dimensions too small, trying fallback"),handleYouTubeThumbnailError(t),!1)}}function showYouTubePlaceholder(t){t.src="data:image/svg+xml;base64,"+btoa('\n        <svg xmlns="http://www.w3.org/2000/svg" width="480" height="360" viewBox="0 0 480 360">\n            <rect width="480" height="360" fill="#f0f0f0"/>\n            <rect x="190" y="130" width="100" height="100" rx="50" fill="#ff0000"/>\n            <polygon points="220,155 220,205 250,180" fill="white"/>\n            <text x="240" y="280" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#666">\n                Vid√©o YouTube\n            </text>\n        </svg>\n    '),t.alt="Miniature YouTube non disponible",t.removeAttribute("onerror")}async function checkYouTubeThumbnail(t){const e=["maxresdefault","hqdefault","mqdefault","default"];for(const n of e){const e=`https://img.youtube.com/vi/${t}/${n}.jpg`;try{if((await fetch(e,{method:"HEAD"})).ok)return e}catch(t){continue}}return null}document.addEventListener("DOMContentLoaded",function(){const t=document.querySelectorAll(".youtube-thumbnail");console.log("Found YouTube thumbnails:",t.length),t.forEach(function(t){console.log("Processing thumbnail:",t.src),t.complete?(console.log("Image already complete, validating now"),validateYouTubeThumbnail(t)):t.addEventListener("load",function(){console.log("Image loaded, validating:",t.src),validateYouTubeThumbnail(t)}),setTimeout(function(){t.complete&&0!==t.naturalHeight||(console.log("Timeout reached, forcing fallback for:",t.src),handleYouTubeThumbnailError(t))},5e3)})}),window.addEventListener("load",function(){console.log("Window fully loaded, rechecking thumbnails");document.querySelectorAll(".youtube-thumbnail").forEach(function(t){t.complete&&!t.hasAttribute("data-validated")&&(console.log("Found unvalidated complete image:",t.src),validateYouTubeThumbnail(t))})});