{% extends 'plongee_base.html.twig' %}

{% block title %}Calendrier des Activit√©s - Club Subaquatique des V√©n√®tes{% endblock %}

{% block body %}
<div class="bg-white py-8">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold tracking-tight text-club-blue mb-4">
                Calendrier des Activit√©s
            </h1>
            <p class="text-xl text-gray-600">
                Toutes les sorties, formations et √©v√©nements du club
            </p>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Calendrier principal -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <!-- Navigation du calendrier -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-4">
                            <a href="{{ path('public_calendar', {year: prev_year, month: prev_month}) }}" 
                               class="p-2 text-gray-400 hover:text-club-orange transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </a>
                            <h2 class="text-2xl font-bold text-club-blue">
                                {% set months = ['', 'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'] %}
                                {{ months[current_month] }} {{ current_year }}
                            </h2>
                            <a href="{{ path('public_calendar', {year: next_year, month: next_month}) }}" 
                               class="p-2 text-gray-400 hover:text-club-orange transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </a>
                        </div>
                        <a href="{{ path('public_calendar') }}" 
                           class="px-4 py-2 text-sm font-medium text-club-orange hover:text-club-orange-dark">
                            Aujourd'hui
                        </a>
                    </div>

                    <!-- Grille du calendrier -->
                    {% set firstDay = date(current_year ~ '-' ~ current_month ~ '-01') %}
                    {% set startOfWeek = firstDay.format('N') %}
                    {% set daysInMonth = firstDay.format('t') %}
                    
                    <div class="grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden">
                        <!-- En-t√™tes des jours -->
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Lun</div>
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Mar</div>
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Mer</div>
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Jeu</div>
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Ven</div>
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Sam</div>
                        <div class="bg-gray-50 p-2 text-center text-sm font-medium text-gray-500">Dim</div>

                        <!-- Cases vides du d√©but -->
                        {% if startOfWeek > 1 %}
                            {% for i in 1..(startOfWeek - 1) %}
                                <div class="bg-white h-24"></div>
                            {% endfor %}
                        {% endif %}

                        <!-- Jours du mois -->
                        {% for day in 1..daysInMonth %}
                            {% set currentDate = date(current_year ~ '-' ~ current_month ~ '-' ~ day) %}
                            {% set isToday = currentDate.format('Y-m-d') == 'now'|date('Y-m-d') %}
                            {% set dayEvents = [] %}
                            {% for event in events %}
                                {% if event.startDate.format('Y-m-d') == currentDate.format('Y-m-d') %}
                                    {% set dayEvents = dayEvents|merge([event]) %}
                                {% endif %}
                            {% endfor %}

                            <div class="bg-white h-24 p-1 {{ isToday ? 'ring-2 ring-club-orange' : '' }}">
                                <div class="text-sm {{ isToday ? 'font-bold text-club-orange' : 'text-gray-900' }}">
                                    {{ day }}
                                </div>
                                {% for event in dayEvents|slice(0, 2) %}
                                    <div class="mt-1">
                                        <a href="{{ path('calendar_event_detail', {id: event.id}) }}" 
                                           class="block text-xs px-1 py-0.5 rounded text-white truncate hover:opacity-80"
                                           style="background-color: {{ event.color ?? '#FD7E29' }}"
                                           title="{{ event.title }}">
                                            {{ event.title }}
                                        </a>
                                    </div>
                                {% endfor %}
                                {% if dayEvents|length > 2 %}
                                    <div class="text-xs text-gray-500">+{{ dayEvents|length - 2 }}</div>
                                {% endif %}
                            </div>
                        {% endfor %}

                        <!-- Cases vides de fin -->
                        {% set emptyCellsAtStart = startOfWeek > 1 ? (startOfWeek - 1) : 0 %}
                        {% set totalCells = emptyCellsAtStart + daysInMonth %}
                        {% set remainingCells = 42 - totalCells %}
                        {% if remainingCells > 0 %}
                            {% for i in 1..remainingCells %}
                                <div class="bg-white h-24"></div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sidebar avec √©v√©nements √† venir -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h3 class="text-xl font-bold text-club-blue mb-4">Prochains √âv√©nements</h3>
                    {% if upcoming_events is empty %}
                        <p class="text-gray-500 text-center py-8">Aucun √©v√©nement pr√©vu</p>
                    {% else %}
                        <div class="space-y-4">
                            {% for event in upcoming_events %}
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-club-orange transition-colors">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1 min-w-0">
                                            <h4 class="text-sm font-medium text-gray-900 truncate">
                                                <a href="{{ path('calendar_event_detail', {id: event.id}) }}" 
                                                   class="hover:text-club-orange">
                                                    {{ event.title }}
                                                </a>
                                            </h4>
                                            <p class="text-xs text-gray-500 mt-1">
                                                {{ event.startDate|date('d/m √† H:i') }}
                                            </p>
                                            {% if event.location %}
                                                <p class="text-xs text-gray-500">
                                                    üìç {{ event.location }}
                                                </p>
                                            {% endif %}
                                        </div>
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                              style="background-color: {{ event.color ?? '#FD7E29' }}1A; color: {{ event.color ?? '#FD7E29' }}">
                                            {{ event.typeDisplayName }}
                                        </span>
                                    </div>
                                    {% if event.maxParticipants %}
                                        <div class="mt-2">
                                            <div class="flex items-center justify-between text-xs text-gray-500">
                                                <span>Places:</span>
                                                <span>{{ event.currentParticipants }}/{{ event.maxParticipants }}</span>
                                            </div>
                                            <div class="w-full bg-gray-200 rounded-full h-1.5 mt-1">
                                                {% set percentage = event.maxParticipants > 0 ? (event.currentParticipants / event.maxParticipants * 100) : 0 %}
                                                <div class="bg-club-orange h-1.5 rounded-full" 
                                                     style="width: {{ percentage }}%"></div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- L√©gende des types d'√©v√©nements -->
                {% if event_types is not empty %}
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold text-club-blue mb-4">Types d'activit√©s</h3>
                    <div class="space-y-3 text-sm">
                        {% for event_type in event_types %}
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full mr-3" style="background-color: {{ event_type.color }}"></div>
                                <span>{{ event_type.name }}</span>
                                {% if event_type.description %}
                                    <span class="text-gray-500 text-xs ml-2">- {{ event_type.description }}</span>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold text-club-blue mb-4">Types d'activit√©s</h3>
                    <div class="text-center py-6">
                        <svg class="mx-auto h-8 w-8 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a1.994 1.994 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                        </svg>
                        <p class="text-sm text-gray-500">Aucun type d'√©v√©nement configur√©</p>
                        <p class="text-xs text-gray-400 mt-1">
                            <a href="{{ path('admin_event_types_list') }}" class="text-club-orange hover:text-club-orange-dark">
                                Cr√©er des types d'√©v√©nements
                            </a>
                        </p>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}